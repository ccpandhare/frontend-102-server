<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>B7</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<style type="text/css">
		html, body {
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
		#map {
			position: absolute;
			left: 0;
			top: 0;
            transform-origin: 0 0;
            min-width: 100vw;
            min-height: 100vh;
		}
	</style>
</head>
<body>
	<div id="map" src="map.jpg"></div>
	<script type="text/javascript">
		var map = document.getElementById('map');
		var down=false;
		var elOffset=[0,0];
		var cursorPos=[0,0];
		var dist;
		// pan events
		// map.addEventListener("mousedown", mousedownFunc);
		map.addEventListener("touchstart", touchstartFunc);
		// map.addEventListener("mouseup", mouseupFunc);
		map.addEventListener("touchend", touchendFunc);
		// map.addEventListener("mousemove", mousemoveFunc);
		map.addEventListener("touchmove", touchmoveFunc);

		// zoom events
		var mousewheelevt=(/Firefox/i.test(navigator.userAgent))? "DOMMouseScroll" : "mousewheel"; //FF doesn't recognize mousewheel as of FF3.x
		map.addEventListener(mousewheelevt, mousewheelFunc);

		var zoom=false;
		function touchstartFunc(e) {
            // alert(e.touches.length);
			if(e.touches.length==2)
			{
				zoom=true;
				down=true;
				dist =(e.touches[0].pageX-e.touches[1].pageX) * (e.touches[0].pageX-e.touches[1].pageX) + (e.touches[0].pageY-e.touches[1].pageY) * (e.touches[0].pageY-e.touches[1].pageY);
			}
			down=true;
			elOffset=[
				map.offsetLeft - e.changedTouches[0].clientX,
				map.offsetTop - e.changedTouches[0].clientY
			];
			e.preventDefault();
		}
		function touchendFunc(e) {
			// e.preventDefault();
			if(e.touches.length==0 || e.touches.length==2)
				down=false;
			else
				down=true;
		}
		var tchscale=1.0;
		function touchmoveFunc(e) {
            map.innerHTML = e.touches.length;
			e.preventDefault();
			map.ondragstart = function() { return false; };
			if(down)
			{
				cursorPos=[
					e.changedTouches[0].clientX,
					e.changedTouches[0].clientY
				];
				styleLeft=elOffset[0] + cursorPos[0];
				styleTop=elOffset[1] + cursorPos[1];
				if(styleTop>0)
					styleTop=0;
				if(styleTop<-(map.clientHeight-document.documentElement.clientHeight))
					styleTop=-(map.clientHeight-document.documentElement.clientHeight);
				if(styleLeft>0)
					styleLeft=0;
				if(styleLeft<-(map.clientWidth-document.documentElement.clientWidth))
					styleLeft=-(map.clientWidth-document.documentElement.clientWidth);
				map.style.left =  styleLeft+ 'px';
				map.style.top = styleTop + 'px';
			}
		}
		var scale=1.0;
	</script>
</body>
</html>